{% load static %}
<!-- Sidebar con menú colapsable y animaciones -->
<aside id="sidebar" class="sidebar-expanded w-72 gradient-brand flex flex-col shadow-2xl relative overflow-visible transition-all duration-300 ease-in-out lg:translate-x-0 -translate-x-full fixed lg:relative h-full z-50">
    <!-- Decoración de fondo -->
    <div class="absolute inset-0 opacity-10 pointer-events-none overflow-hidden">
        <div class="absolute top-0 right-0 w-64 h-64 bg-white rounded-full -translate-y-1/2 translate-x-1/2 animate-blob"></div>
        <div class="absolute bottom-0 left-0 w-48 h-48 bg-white rounded-full translate-y-1/2 -translate-x-1/2 animate-blob animation-delay-2000"></div>
    </div>
    
    <!-- Botón para colapsar (visible y accesible) -->
    <button onclick="toggleSidebar()" 
            class="collapse-btn hidden lg:flex absolute -right-4 top-8 w-8 h-8 bg-white rounded-full items-center justify-center shadow-lg hover:shadow-xl border-2 border-slate-100 transition-all duration-300 hover:scale-110 z-[60] group"
            title="Colapsar menú">
        <i id="collapse-icon" class="fas fa-chevron-left text-brand-600 text-sm transition-transform duration-300 group-hover:text-brand-800"></i>
    </button>
    
    <!-- Logo y título -->
    <div class="relative z-10 p-5 border-b border-white/10">
        <div class="flex items-center gap-3 justify-center lg:justify-start">
            <div class="logo-icon flex items-center justify-center transform hover:scale-110 transition-all duration-300 cursor-pointer flex-shrink-0">
                <img src="{% static 'images/minilogo-final-final.png' %}" alt="Seguros UTPL" class="h-12 w-auto object-contain drop-shadow-2xl filter brightness-110">
            </div>
            <div class="sidebar-text overflow-hidden">
                <h1 class="text-xl font-bold text-white tracking-tight whitespace-nowrap">Seguros</h1>
                <span class="text-xs font-semibold text-gold-400 tracking-widest">UTPL</span>
            </div>
        </div>
    </div>
    
    <!-- Navegación -->
    <nav class="relative z-10 flex-1 overflow-y-auto overflow-x-hidden px-3 py-4 space-y-1">
        <!-- Dashboard -->
        <a href="{% url 'dashboard' %}" 
           class="nav-item flex items-center gap-3 px-3 py-2.5 rounded-xl text-white/90 hover:bg-white/10 group {% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}"
           title="Dashboard">
            <div class="nav-icon w-9 h-9 rounded-lg bg-white/10 flex items-center justify-center group-hover:bg-white/20 transition-all duration-300 flex-shrink-0">
                <i class="fas fa-house"></i>
            </div>
            <span class="sidebar-text font-medium whitespace-nowrap overflow-hidden">Dashboard</span>
        </a>
        
        <!-- Sección: Gestión -->
        <div class="pt-3">
            <button onclick="toggleSubmenu('gestion')" 
                    class="section-header w-full flex items-center gap-2 px-3 py-2 text-[10px] font-bold text-gold-400 uppercase tracking-[0.15em] hover:text-gold-300 transition-colors rounded-lg hover:bg-white/5">
                <i class="fas fa-layer-group text-[9px] sidebar-collapsed-icon hidden"></i>
                <span class="sidebar-text flex-1 text-left">Gestión</span>
                <i id="gestion-arrow" class="fas fa-chevron-down text-[8px] transition-transform duration-300 sidebar-text"></i>
            </button>
            <div id="gestion-menu" class="submenu space-y-1 mt-1 overflow-hidden transition-all duration-300" style="max-height: 400px;">
                <a href="{% url 'polizas_lista' %}" 
                   class="nav-item flex items-center gap-3 px-3 py-2.5 rounded-xl text-white/90 hover:bg-white/10 group {% if 'polizas' in request.path and 'desglose' not in request.path %}active{% endif %}"
                   title="Pólizas">
                    <div class="nav-icon w-9 h-9 rounded-lg bg-white/10 flex items-center justify-center group-hover:bg-white/20 transition-all duration-300 flex-shrink-0">
                        <i class="fas fa-file-shield"></i>
                    </div>
                    <span class="sidebar-text font-medium whitespace-nowrap overflow-hidden">Pólizas</span>
                </a>
                
                <a href="{% url 'desglose_ramos_lista' %}" 
                   class="nav-item flex items-center gap-3 px-3 py-2.5 rounded-xl text-white/90 hover:bg-white/10 group {% if 'desglose-ramos' in request.path %}active{% endif %}"
                   title="Desglose por Ramos">
                    <div class="nav-icon w-9 h-9 rounded-lg bg-white/10 flex items-center justify-center group-hover:bg-white/20 transition-all duration-300 flex-shrink-0">
                        <i class="fas fa-layer-group"></i>
                    </div>
                    <span class="sidebar-text font-medium whitespace-nowrap overflow-hidden">Desglose Ramos</span>
                </a>
                
                <a href="{% url 'facturas_lista' %}" 
                   class="nav-item flex items-center gap-3 px-3 py-2.5 rounded-xl text-white/90 hover:bg-white/10 group {% if 'facturas' in request.path %}active{% endif %}"
                   title="Facturas">
                    <div class="nav-icon w-9 h-9 rounded-lg bg-white/10 flex items-center justify-center group-hover:bg-white/20 transition-all duration-300 flex-shrink-0">
                        <i class="fas fa-file-invoice-dollar"></i>
                    </div>
                    <span class="sidebar-text font-medium whitespace-nowrap overflow-hidden">Facturas</span>
                    {% if stats.facturas_pendientes > 0 %}
                        <span class="badge-count ml-auto bg-amber-500 text-white text-[10px] font-bold w-5 h-5 rounded-full flex items-center justify-center flex-shrink-0">
                            {{ stats.facturas_pendientes }}
                        </span>
                    {% endif %}
                </a>
                
                <a href="{% url 'siniestros_lista' %}" 
                   class="nav-item flex items-center gap-3 px-3 py-2.5 rounded-xl text-white/90 hover:bg-white/10 group {% if 'siniestros' in request.path %}active{% endif %}"
                   title="Siniestros">
                    <div class="nav-icon w-9 h-9 rounded-lg bg-white/10 flex items-center justify-center group-hover:bg-white/20 transition-all duration-300 flex-shrink-0">
                        <i class="fas fa-car-burst"></i>
                    </div>
                    <span class="sidebar-text font-medium whitespace-nowrap overflow-hidden">Siniestros</span>
                    {% if stats.siniestros_activos > 0 %}
                        <span class="badge-count ml-auto bg-red-500 text-white text-[10px] font-bold w-5 h-5 rounded-full flex items-center justify-center animate-pulse flex-shrink-0">
                            {{ stats.siniestros_activos }}
                        </span>
                    {% endif %}
                </a>
                
                <a href="{% url 'documentos_lista' %}" 
                   class="nav-item flex items-center gap-3 px-3 py-2.5 rounded-xl text-white/90 hover:bg-white/10 group {% if 'documentos' in request.path %}active{% endif %}"
                   title="Documentos">
                    <div class="nav-icon w-9 h-9 rounded-lg bg-white/10 flex items-center justify-center group-hover:bg-white/20 transition-all duration-300 flex-shrink-0">
                        <i class="fas fa-folder-open"></i>
                    </div>
                    <span class="sidebar-text font-medium whitespace-nowrap overflow-hidden">Documentos</span>
                </a>
            </div>
        </div>
        
        <!-- Sección: Gestión Avanzada -->
        <div class="pt-3">
            <button onclick="toggleSubmenu('avanzada')" 
                    class="section-header w-full flex items-center gap-2 px-3 py-2 text-[10px] font-bold text-gold-400 uppercase tracking-[0.15em] hover:text-gold-300 transition-colors rounded-lg hover:bg-white/5">
                <i class="fas fa-rocket text-[9px] sidebar-collapsed-icon hidden"></i>
                <span class="sidebar-text flex-1 text-left">Avanzado</span>
                <i id="avanzada-arrow" class="fas fa-chevron-down text-[8px] transition-transform duration-300 sidebar-text"></i>
            </button>
            <div id="avanzada-menu" class="submenu space-y-1 mt-1 overflow-hidden transition-all duration-300" style="max-height: 400px;">
                <a href="{% url 'renewals_list' %}" 
                   class="nav-item flex items-center gap-3 px-3 py-2.5 rounded-xl text-white/90 hover:bg-white/10 group {% if 'renovaciones' in request.path %}active{% endif %}"
                   title="Renovaciones">
                    <div class="nav-icon w-9 h-9 rounded-lg bg-white/10 flex items-center justify-center group-hover:bg-white/20 transition-all duration-300 flex-shrink-0">
                        <i class="fas fa-sync-alt"></i>
                    </div>
                    <span class="sidebar-text font-medium whitespace-nowrap overflow-hidden">Renovaciones</span>
                </a>
                
                <a href="{% url 'quotes_list' %}" 
                   class="nav-item flex items-center gap-3 px-3 py-2.5 rounded-xl text-white/90 hover:bg-white/10 group {% if 'cotizaciones' in request.path %}active{% endif %}"
                   title="Cotizaciones">
                    <div class="nav-icon w-9 h-9 rounded-lg bg-white/10 flex items-center justify-center group-hover:bg-white/20 transition-all duration-300 flex-shrink-0">
                        <i class="fas fa-file-invoice-dollar"></i>
                    </div>
                    <span class="sidebar-text font-medium whitespace-nowrap overflow-hidden">Cotizaciones</span>
                </a>
                
                <a href="{% url 'assets_list' %}" 
                   class="nav-item flex items-center gap-3 px-3 py-2.5 rounded-xl text-white/90 hover:bg-white/10 group {% if 'bienes' in request.path %}active{% endif %}"
                   title="Bienes Asegurados">
                    <div class="nav-icon w-9 h-9 rounded-lg bg-white/10 flex items-center justify-center group-hover:bg-white/20 transition-all duration-300 flex-shrink-0">
                        <i class="fas fa-boxes"></i>
                    </div>
                    <span class="sidebar-text font-medium whitespace-nowrap overflow-hidden">Bienes</span>
                </a>
                
                <a href="{% url 'calendar_view' %}" 
                   class="nav-item flex items-center gap-3 px-3 py-2.5 rounded-xl text-white/90 hover:bg-white/10 group {% if 'calendario' in request.path %}active{% endif %}"
                   title="Calendario">
                    <div class="nav-icon w-9 h-9 rounded-lg bg-white/10 flex items-center justify-center group-hover:bg-white/20 transition-all duration-300 flex-shrink-0">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <span class="sidebar-text font-medium whitespace-nowrap overflow-hidden">Calendario</span>
                </a>
                
                <a href="{% url 'payment_approvals_list' %}" 
                   class="nav-item flex items-center gap-3 px-3 py-2.5 rounded-xl text-white/90 hover:bg-white/10 group {% if 'aprobaciones' in request.path %}active{% endif %}"
                   title="Aprobaciones">
                    <div class="nav-icon w-9 h-9 rounded-lg bg-white/10 flex items-center justify-center group-hover:bg-white/20 transition-all duration-300 flex-shrink-0">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <span class="sidebar-text font-medium whitespace-nowrap overflow-hidden">Aprobaciones</span>
                </a>
            </div>
        </div>
        
        <!-- Sección: Análisis -->
        <div class="pt-3">
            <button onclick="toggleSubmenu('analisis')" 
                    class="section-header w-full flex items-center gap-2 px-3 py-2 text-[10px] font-bold text-gold-400 uppercase tracking-[0.15em] hover:text-gold-300 transition-colors rounded-lg hover:bg-white/5">
                <i class="fas fa-chart-pie text-[9px] sidebar-collapsed-icon hidden"></i>
                <span class="sidebar-text flex-1 text-left">Análisis</span>
                <i id="analisis-arrow" class="fas fa-chevron-down text-[8px] transition-transform duration-300 sidebar-text"></i>
            </button>
            <div id="analisis-menu" class="submenu space-y-1 mt-1 overflow-hidden transition-all duration-300" style="max-height: 400px;">
                <a href="{% url 'reportes_dashboard' %}" 
                   class="nav-item flex items-center gap-3 px-3 py-2.5 rounded-xl text-white/90 hover:bg-white/10 group {% if 'reportes' in request.path %}active{% endif %}"
                   title="Reportes">
                    <div class="nav-icon w-9 h-9 rounded-lg bg-white/10 flex items-center justify-center group-hover:bg-white/20 transition-all duration-300 flex-shrink-0">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <span class="sidebar-text font-medium whitespace-nowrap overflow-hidden">Reportes</span>
                </a>
                
                <a href="{% url 'analytics_dashboard' %}" 
                   class="nav-item flex items-center gap-3 px-3 py-2.5 rounded-xl text-white/90 hover:bg-white/10 group {% if 'analytics' in request.path %}active{% endif %}"
                   title="Analytics">
                    <div class="nav-icon w-9 h-9 rounded-lg bg-white/10 flex items-center justify-center group-hover:bg-white/20 transition-all duration-300 flex-shrink-0">
                        <i class="fas fa-brain"></i>
                    </div>
                    <span class="sidebar-text font-medium whitespace-nowrap overflow-hidden">Analytics</span>
                </a>
                
                <a href="{% url 'alertas_lista' %}" 
                   class="nav-item flex items-center gap-3 px-3 py-2.5 rounded-xl text-white/90 hover:bg-white/10 group {% if 'alertas' in request.path %}active{% endif %}"
                   title="Alertas">
                    <div class="nav-icon w-9 h-9 rounded-lg bg-white/10 flex items-center justify-center group-hover:bg-white/20 transition-all duration-300 flex-shrink-0">
                        <i class="fas fa-bell"></i>
                    </div>
                    <span class="sidebar-text font-medium whitespace-nowrap overflow-hidden">Alertas</span>
                    {% if alertas_pendientes_count > 0 %}
                        <span class="badge-count ml-auto bg-red-500 text-white text-[10px] font-bold w-5 h-5 rounded-full flex items-center justify-center badge-pulse flex-shrink-0">
                            {{ alertas_pendientes_count }}
                        </span>
                    {% endif %}
                </a>
            </div>
        </div>
        
        <!-- Sección: Sistema -->
        <div class="pt-3">
            <button onclick="toggleSubmenu('sistema')" 
                    class="section-header w-full flex items-center gap-2 px-3 py-2 text-[10px] font-bold text-gold-400 uppercase tracking-[0.15em] hover:text-gold-300 transition-colors rounded-lg hover:bg-white/5">
                <i class="fas fa-cog text-[9px] sidebar-collapsed-icon hidden"></i>
                <span class="sidebar-text flex-1 text-left">Sistema</span>
                <i id="sistema-arrow" class="fas fa-chevron-down text-[8px] transition-transform duration-300 sidebar-text"></i>
            </button>
            <div id="sistema-menu" class="submenu space-y-1 mt-1 overflow-hidden transition-all duration-300" style="max-height: 400px;">
                <a href="/admin/" 
                   class="nav-item flex items-center gap-3 px-3 py-2.5 rounded-xl text-white/90 hover:bg-white/10 group"
                   title="Administración">
                    <div class="nav-icon w-9 h-9 rounded-lg bg-white/10 flex items-center justify-center group-hover:bg-white/20 transition-all duration-300 flex-shrink-0">
                        <i class="fas fa-gear"></i>
                    </div>
                    <span class="sidebar-text font-medium whitespace-nowrap overflow-hidden">Administración</span>
                </a>
                
                <a href="/admin/app/configuracionsistema/" 
                   class="nav-item flex items-center gap-3 px-3 py-2.5 rounded-xl text-white/90 hover:bg-white/10 group"
                   title="Configuración">
                    <div class="nav-icon w-9 h-9 rounded-lg bg-white/10 flex items-center justify-center group-hover:bg-white/20 transition-all duration-300 flex-shrink-0">
                        <i class="fas fa-sliders"></i>
                    </div>
                    <span class="sidebar-text font-medium whitespace-nowrap overflow-hidden">Configuración</span>
                </a>
            </div>
        </div>
    </nav>
    
    <!-- Usuario / Footer -->
    <div class="relative z-10 p-3 border-t border-white/10">
        <div class="user-card flex items-center gap-3 p-2.5 rounded-xl bg-white/5 hover:bg-white/10 transition-all duration-300 group">
            <div class="w-9 h-9 gradient-gold rounded-lg flex items-center justify-center shadow transform group-hover:scale-105 transition-all duration-300 flex-shrink-0">
                <span class="text-brand-900 font-bold text-sm">
                    {{ user.first_name|slice:":1"|default:user.username|slice:":1"|upper }}
                </span>
            </div>
            <div class="sidebar-text flex-1 min-w-0 overflow-hidden">
                <p class="text-sm font-semibold text-white truncate">
                    {{ user.get_full_name|default:user.username }}
                </p>
                <p class="text-[11px] text-white/50 truncate">{{ user.email|default:"Admin" }}</p>
            </div>
            <a href="{% url 'logout' %}" 
               class="sidebar-text text-white/50 hover:text-red-400 transition-colors p-1.5 rounded-lg hover:bg-white/10" 
               title="Cerrar sesión">
                <i class="fas fa-right-from-bracket"></i>
            </a>
        </div>
    </div>
</aside>

<!-- Overlay para móvil -->
<div id="sidebar-overlay" onclick="closeSidebar()" class="sidebar-overlay fixed inset-0 bg-black/50 backdrop-blur-sm z-40 lg:hidden opacity-0 pointer-events-none transition-all duration-300"></div>

<!-- Botón hamburguesa para móvil -->
<button id="mobile-menu-btn" onclick="openSidebar()" 
        class="lg:hidden fixed bottom-6 right-6 w-14 h-14 gradient-brand rounded-2xl flex items-center justify-center shadow-xl z-30 hover:scale-110 active:scale-95 transition-transform duration-200">
    <i class="fas fa-bars text-white text-xl"></i>
</button>

<style>
/* ===== SIDEBAR STYLES ===== */

/* Botón de colapso siempre visible */
.collapse-btn {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Textos y elementos con transición suave */
#sidebar .sidebar-text {
    transition: opacity 0.2s ease, width 0.2s ease;
    white-space: nowrap;
}

#sidebar .nav-item,
#sidebar .section-header,
#sidebar .user-card {
    transition: all 0.2s ease;
}

/* ===== ESTADO COLAPSADO ===== */
#sidebar.sidebar-collapsed .sidebar-text {
    opacity: 0;
    width: 0;
    overflow: hidden;
}

#sidebar.sidebar-collapsed .sidebar-collapsed-icon {
    display: flex !important;
}

#sidebar.sidebar-collapsed .nav-item {
    justify-content: center;
    padding-left: 0.875rem;
    padding-right: 0.875rem;
}

#sidebar.sidebar-collapsed .section-header {
    justify-content: center;
}

#sidebar.sidebar-collapsed .submenu {
    max-height: 0 !important;
    opacity: 0;
    margin-top: 0;
}

#sidebar.sidebar-collapsed .user-card {
    justify-content: center;
    padding: 0.625rem;
}

#sidebar.sidebar-collapsed .badge-count {
    position: absolute;
    top: 2px;
    right: 2px;
    width: 14px;
    height: 14px;
    font-size: 8px;
}

#sidebar.sidebar-collapsed .nav-item {
    position: relative;
}

/* Logo centrado cuando colapsado */
#sidebar.sidebar-collapsed .logo-icon {
    margin: 0 auto;
}

/* ===== TOOLTIPS EN ESTADO COLAPSADO ===== */
#sidebar.sidebar-collapsed .nav-item[title]:hover::after {
    content: attr(title);
    position: absolute;
    left: calc(100% + 12px);
    top: 50%;
    transform: translateY(-50%);
    background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
    color: white;
    padding: 8px 14px;
    border-radius: 8px;
    font-size: 13px;
    font-weight: 500;
    white-space: nowrap;
    z-index: 200;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    animation: tooltipFadeIn 0.15s ease-out;
}

#sidebar.sidebar-collapsed .nav-item[title]:hover::before {
    content: '';
    position: absolute;
    left: calc(100% + 6px);
    top: 50%;
    transform: translateY(-50%);
    border: 6px solid transparent;
    border-right-color: #1f2937;
    z-index: 200;
    animation: tooltipFadeIn 0.15s ease-out;
}

@keyframes tooltipFadeIn {
    from { opacity: 0; transform: translateY(-50%) translateX(-5px); }
    to { opacity: 1; transform: translateY(-50%) translateX(0); }
}

/* Icono de colapso rotado */
#sidebar.sidebar-collapsed #collapse-icon {
    transform: rotate(180deg);
}

/* ===== ITEM ACTIVO ===== */
.nav-item.active {
    background: rgba(255, 255, 255, 0.15);
}

.nav-item.active .nav-icon {
    background: rgba(255, 255, 255, 0.25);
}

/* ===== BADGE PULSE ===== */
@keyframes badgePulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}

.badge-pulse {
    animation: badgePulse 2s ease-in-out infinite;
}
</style>
